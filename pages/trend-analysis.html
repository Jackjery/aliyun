<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据趋势分析 - 卫星任务数据分析平台</title>
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">

    <!-- 🚀 性能优化：预解析API和WebSocket服务器，减少首次请求延迟 -->
    <link rel="dns-prefetch" href="https://records-bsjjdmpsel.cn-hangzhou.fcapp.run">
    <link rel="preconnect" href="https://records-bsjjdmpsel.cn-hangzhou.fcapp.run">
    <link rel="dns-prefetch" href="https://ws.nxjyx.com.cn">
    <link rel="preconnect" href="https://ws.nxjyx.com.cn">

    <!-- 🎨 主题系统 - 支持深色/浅色模式 + 多彩主题切换 -->
    <link rel="stylesheet" href="../public/css/themes.css">

    <!-- 本地资源 - 极简SVG方案 -->
    <!-- 本地Tailwind CSS -->
    <link rel="stylesheet" href="../public/css/output.css">
    <!-- 本地图标系统 -->
    <link rel="stylesheet" href="../public/css/icons.css">
    <!-- Trend Analysis 页面专用样式 -->
    <link rel="stylesheet" href="../public/css/trend-analysis.css">

    <!-- iframe 辅助脚本 - 检测并隐藏导航栏 -->
    <script src="../public/js/common/iframe-helper.js"></script>

    <!-- 配置文件 - 必须最先加载 -->
    <script src="../public/js/common/config.js"></script>

    <!-- 状态管理器 - IndexedDB -->
    <script src="../public/js/common/state-manager.js"></script>

    <!-- 图表库 - 移除defer确保顺序加载 -->
    <script src="../public/lib/chart.min.js"></script>
    <script src="../public/lib/chartjs-plugin-datalabels.min.js"></script>
    <script src="../public/js/pages/trend/trend-analysis-init.js"></script>
</head>
<body style="background-color: rgb(var(--bg-primary)); min-height: 100vh; color: rgb(var(--text-primary)); transition: all 0.3s;">
    <!-- SVG图标库 - 异步加载不阻塞渲染 -->
    <div style="display:none" id="svg-sprite-container"></div>

    <main class="container mx-auto px-4 pt-4 pb-6">
        <!-- 筛选条件区域 - 固定顶部 -->
        <section id="filterSection" class="sticky-filter-section">
            <h3 class="text-lg font-semibold mb-4">筛选条件</h3>

            <!-- 时间范围和周期设置 -->
            <div class="grid grid-cols-5 mb-4 pb-4 border-b border-gray-100">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">统计开始日期</label>
                    <div style="position: relative; display: flex; align-items: center;">
                        <input type="date" id="startDate" class="filter-select" style="flex: 1;">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">统计结束日期</label>
                    <div style="position: relative; display: flex; align-items: center;">
                        <input type="date" id="endDate" class="filter-select" style="flex: 1;">
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between mb-1">
                        <label class="block text-sm font-medium text-gray-700">统计周期</label>
                        <button id="configGroupingBtn" class="text-gray-500 hover:text-primary transition-colors p-1" title="配置周期规则">
                            <svg class="inline-block" width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                                <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319z"/>
                            </svg>
                        </button>
                    </div>
                    <select id="groupBy" class="filter-select">
                        <option value="day">按日</option>
                        <option value="week">按周</option>
                        <option value="month">按月</option>
                        <option value="quarter">按季度</option>
                    </select>
                </div>
                <div class="flex items-end">
                    <button id="resetFilters" class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors">
                        重置筛选
                    </button>
                </div>
                <div class="flex items-end">
                    <button id="applyFilters" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                        应用筛选并生成图表
                    </button>
                </div>
            </div>

            <!-- 多条件筛选区域 -->
            <div class="grid grid-cols-5">
                <!-- 测站名称筛选 -->
                <div class="dropdown-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">测站名称 <span class="text-xs text-gray-500">(可多选)</span></label>
                    <div class="filter-select cursor-pointer" id="stationDropdown">
                        <div class="filter-input-area">
                            <div class="selected-tags-inline" id="stationTags"></div>
                            <input type="text" placeholder="搜索测站..." id="stationSearch">
                        </div>
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                    <div class="dropdown-content hidden" id="stationOptions">
                        <div class="dropdown-options-list"></div>
                        <div class="dropdown-footer">
                            <div class="select-all-item" id="selectAllStations">
                                <input type="checkbox"><span>全选</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="stationValue" value="">
                </div>

                <!-- 客户名称筛选 -->
                <div class="dropdown-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">客户名称 <span class="text-xs text-gray-500">(可多选)</span></label>
                    <div class="filter-select cursor-pointer" id="customerDropdown">
                        <div class="filter-input-area">
                            <div class="selected-tags-inline" id="customerTags"></div>
                            <input type="text" placeholder="搜索客户..." id="customerSearch">
                        </div>
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                    <div class="dropdown-content hidden" id="customerOptions">
                        <div class="dropdown-options-list"></div>
                        <div class="dropdown-footer">
                            <div class="select-all-item" id="selectAllCustomers">
                                <input type="checkbox"><span>全选</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="customerValue" value="">
                </div>

                <!-- 卫星名称筛选 -->
                <div class="dropdown-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">卫星名称 <span class="text-xs text-gray-500">(可多选)</span></label>
                    <div class="filter-select cursor-pointer" id="satelliteDropdown">
                        <div class="filter-input-area">
                            <div class="selected-tags-inline" id="satelliteTags"></div>
                            <input type="text" placeholder="搜索卫星..." id="satelliteSearch">
                        </div>
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                    <div class="dropdown-content hidden" id="satelliteOptions">
                        <div class="dropdown-options-list"></div>
                        <div class="dropdown-footer">
                            <div class="select-all-item" id="selectAllSatellites">
                                <input type="checkbox"><span>全选</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="satelliteValue" value="">
                </div>

                <!-- 任务类型筛选 -->
                <div class="dropdown-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">任务类型 <span class="text-xs text-gray-500">(可多选)</span></label>
                    <div class="filter-select cursor-pointer" id="typeDropdown">
                        <div class="filter-input-area">
                            <div class="selected-tags-inline" id="typeTags"></div>
                            <input type="text" placeholder="搜索类型..." id="typeSearch">
                        </div>
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                    <div class="dropdown-content hidden" id="typeOptions">
                        <div class="dropdown-options-list"></div>
                        <div class="dropdown-footer">
                            <div class="select-all-item" id="selectAllTypes">
                                <input type="checkbox"><span>全选</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="typeValue" value="">
                </div>

                <!-- 任务结果状态筛选 -->
                <div class="dropdown-container">
                    <label class="block text-sm font-medium text-gray-700 mb-1">任务结果状态 <span class="text-xs text-gray-500">(可多选)</span></label>
                    <div class="filter-select cursor-pointer" id="statusDropdown">
                        <div class="filter-input-area">
                            <div class="selected-tags-inline" id="statusTags"></div>
                            <input type="text" placeholder="搜索状态..." id="statusSearch">
                        </div>
                        <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                    </div>
                    <div class="dropdown-content hidden" id="statusOptions">
                        <div class="dropdown-options-list"></div>
                        <div class="dropdown-footer">
                            <div class="select-all-item" id="selectAllStatuses">
                                <input type="checkbox"><span>全选</span>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="statusValue" value="">
                </div>
            </div>
        </section>

        <!-- 加载状态 -->
        <div id="loadingAlert" class="mb-4 p-2.5 bg-primary/10 text-primary rounded-lg flex items-center hidden">
            <svg class="icon icon-spin mr-2"><use href="#icon-spinner"/></svg>
            <span id="loadingMessage">正在加载数据...</span>
        </div>

        <!-- 错误提示 -->
        <div id="errorAlert" class="bg-danger/10 text-danger p-3 rounded-lg mb-4 hidden">
            <svg class="icon mr-2"><use href="#icon-exclamation-circle"/></svg>
            <span id="errorMessage">操作失败</span>
        </div>

        <!-- 图表展示区域 -->
        <section id="chartsSection" class="space-y-4 hidden">
            <!-- 测站趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>测站名称趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <div class="dropdown-container relative" style="width: 147px;">
                            <div class="filter-select cursor-pointer flex items-center" id="stationChartDropdown" style="font-size: 13px; height: 32px; padding: 0 10px; min-height: auto;">
                                <div class="filter-input-area">
                                    <div class="selected-tags-inline" id="stationChartTags"></div>
                                    <input type="text" placeholder="请选择..." id="stationChartSearch">
                                </div>
                                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </div>
                            <div class="dropdown-content hidden" id="stationChartOptions">
                                <div class="dropdown-options-list"></div>
                                <div class="dropdown-footer">
                                    <div class="select-all-item" id="selectAllStationChart">
                                        <input type="checkbox"><span>全选</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="stationChartValue" value="">
                        </div>

                        <button id="resetStationChart" class="flex items-center justify-center px-2.5 text-sm bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition whitespace-nowrap" style="height: 32px;" title="重置当前图表筛选">
                            <svg class="icon"><use href="#icon-refresh"/></svg>
                            <span>重置筛选</span>
                        </button>

                        <div class="h-5 w-px bg-gray-300"></div>

                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showStationLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="stationChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="stationChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="stationChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="stationChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="stationChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="stationChartLegend" class="chart-legend-container"></div>
                </div>
            </div>

            <!-- 客户趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>客户名称趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <div class="dropdown-container relative" style="width: 147px;">
                            <div class="filter-select cursor-pointer flex items-center" id="customerChartDropdown" style="font-size: 13px; height: 32px; padding: 0 10px; min-height: auto;">
                                <div class="filter-input-area">
                                    <div class="selected-tags-inline" id="customerChartTags"></div>
                                    <input type="text" placeholder="请选择..." id="customerChartSearch">
                                </div>
                                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </div>
                            <div class="dropdown-content hidden" id="customerChartOptions">
                                <div class="dropdown-options-list"></div>
                                <div class="dropdown-footer">
                                    <div class="select-all-item" id="selectAllCustomerChart">
                                        <input type="checkbox"><span>全选</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="customerChartValue" value="">
                        </div>

                        <button id="resetCustomerChart" class="flex items-center justify-center px-2.5 text-sm bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition whitespace-nowrap" style="height: 32px;" title="重置当前图表筛选">
                            <svg class="icon"><use href="#icon-refresh"/></svg>
                            <span>重置筛选</span>
                        </button>

                        <div class="h-5 w-px bg-gray-300"></div>

                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showCustomerLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="customerChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="customerChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="customerChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="customerChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="customerChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="customerChartLegend" class="chart-legend-container"></div>
                </div>
            </div>

            <!-- 卫星趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>卫星名称趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <div class="dropdown-container relative" style="width: 147px;">
                            <div class="filter-select cursor-pointer flex items-center" id="satelliteChartDropdown" style="font-size: 13px; height: 32px; padding: 0 10px; min-height: auto;">
                                <div class="filter-input-area">
                                    <div class="selected-tags-inline" id="satelliteChartTags"></div>
                                    <input type="text" placeholder="请选择..." id="satelliteChartSearch">
                                </div>
                                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </div>
                            <div class="dropdown-content hidden" id="satelliteChartOptions">
                                <div class="dropdown-options-list"></div>
                                <div class="dropdown-footer">
                                    <div class="select-all-item" id="selectAllSatelliteChart">
                                        <input type="checkbox"><span>全选</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="satelliteChartValue" value="">
                        </div>

                        <button id="resetSatelliteChart" class="flex items-center justify-center px-2.5 text-sm bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition whitespace-nowrap" style="height: 32px;" title="重置当前图表筛选">
                            <svg class="icon"><use href="#icon-refresh"/></svg>
                            <span>重置筛选</span>
                        </button>

                        <div class="h-5 w-px bg-gray-300"></div>

                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showSatelliteLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="satelliteChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="satelliteChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="satelliteChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="satelliteChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="satelliteChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="satelliteChartLegend" class="chart-legend-container"></div>
                </div>
            </div>

            <!-- 任务类型趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>任务类型趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <div class="dropdown-container relative" style="width: 147px;">
                            <div class="filter-select cursor-pointer flex items-center" id="typeChartDropdown" style="font-size: 13px; height: 32px; padding: 0 10px; min-height: auto;">
                                <div class="filter-input-area">
                                    <div class="selected-tags-inline" id="typeChartTags"></div>
                                    <input type="text" placeholder="请选择..." id="typeChartSearch">
                                </div>
                                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </div>
                            <div class="dropdown-content hidden" id="typeChartOptions">
                                <div class="dropdown-options-list"></div>
                                <div class="dropdown-footer">
                                    <div class="select-all-item" id="selectAllTypeChart">
                                        <input type="checkbox"><span>全选</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="typeChartValue" value="">
                        </div>

                        <button id="resetTypeChart" class="flex items-center justify-center px-2.5 text-sm bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition whitespace-nowrap" style="height: 32px;" title="重置当前图表筛选">
                            <svg class="icon"><use href="#icon-refresh"/></svg>
                            <span>重置筛选</span>
                        </button>

                        <div class="h-5 w-px bg-gray-300"></div>

                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showTypeLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="typeChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="typeChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="typeChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="typeChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="typeChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="typeChartLegend" class="chart-legend-container"></div>
                </div>
            </div>

            <!-- 任务状态趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>任务结果状态趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <div class="dropdown-container relative" style="width: 147px;">
                            <div class="filter-select cursor-pointer flex items-center" id="statusChartDropdown" style="font-size: 13px; height: 32px; padding: 0 10px; min-height: auto;">
                                <div class="filter-input-area">
                                    <div class="selected-tags-inline" id="statusChartTags"></div>
                                    <input type="text" placeholder="请选择..." id="statusChartSearch">
                                </div>
                                <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                            </div>
                            <div class="dropdown-content hidden" id="statusChartOptions">
                                <div class="dropdown-options-list"></div>
                                <div class="dropdown-footer">
                                    <div class="select-all-item" id="selectAllStatusChart">
                                        <input type="checkbox"><span>全选</span>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="statusChartValue" value="">
                        </div>

                        <button id="resetStatusChart" class="flex items-center justify-center px-2.5 text-sm bg-gray-100 text-gray-600 rounded hover:bg-gray-200 transition whitespace-nowrap" style="height: 32px;" title="重置当前图表筛选">
                            <svg class="icon"><use href="#icon-refresh"/></svg>
                            <span>重置筛选</span>
                        </button>

                        <div class="h-5 w-px bg-gray-300"></div>

                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showStatusLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="statusChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="statusChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="statusChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="statusChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="statusChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="statusChartLegend" class="chart-legend-container"></div>
                </div>
            </div>

            <!-- 成功率趋势图 -->
            <div class="bg-card rounded-lg p-6 card-shadow">
                <h3 class="text-lg font-semibold mb-4 flex items-center justify-between">
                    <span>成功率趋势分析</span>
                    <div class="flex items-center" style="gap: 8px; margin-left: 15px;">
                        <label class="flex items-center justify-center px-2.5 bg-secondary/10 text-secondary rounded cursor-pointer hover:bg-secondary/20 transition whitespace-nowrap" style="height: 32px;">
                            <input type="checkbox" id="showSuccessRateLabels" class="mr-1.5 w-4 h-4">
                            <span class="text-sm font-medium">显示数据标签</span>
                        </label>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="successRateChart" data-type="image">
                            <svg class="icon"><use href="#icon-download"/></svg>
                            <span>下载图表</span>
                        </button>
                        <button class="chart-download-btn flex items-center justify-center px-2.5 text-sm bg-primary/10 text-primary rounded hover:bg-primary/20 transition whitespace-nowrap" style="height: 32px;"
                                data-chart="successRateChart" data-type="csv">
                            <svg class="icon"><use href="#icon-table"/></svg>
                            <span>下载数据</span>
                        </button>
                    </div>
                </h3>

                <div class="h-96 border border-default rounded-lg p-4 relative flex">
                    <div class="flex-1 relative min-w-0">
                        <canvas id="successRateChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center text-gray-500 hidden" id="successRateChartEmpty">
                            <div class="text-center">
                                <svg class="icon icon-2xl mb-2"><use href="#icon-line-chart"/></svg>
                                <p>没有符合条件的数据</p>
                            </div>
                        </div>
                        <!-- 加载状态 -->
                        <div class="chart-loading-overlay hidden" id="successRateChartLoading">
                            <div class="chart-loading-content">
                                <div class="chart-loading-text">正在渲染图表...</div>
                            </div>
                        </div>
                    </div>
                    <div id="successRateChartLegend" class="chart-legend-container"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- 周期规则配置模态框 -->
    <div id="groupingConfigModal" class="fixed inset-0 modal-backdrop flex items-center justify-center z-50 hidden">
        <div class="bg-card rounded-lg w-full max-w-md p-6 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">周期规则配置（所有时间均为文件时间）</h3>
                <button id="closeConfigModal" class="transition-colors" style="color: rgb(var(--text-secondary));"
                        onmouseover="this.style.color='rgb(var(--text-primary))'"
                        onmouseout="this.style.color='rgb(var(--text-secondary))'">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <div class="mb-6 pb-4 border-b border-gray-100">
                <h4 class="font-medium mb-3">按日周期</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">周期起始时间</label>
                        <input type="time" id="dayStart" class="w-full p-2 border border-gray-300 rounded-md" value="00:00">
                    </div>
                    <div>
                        <p class="block text-sm text-gray-600 mb-1">周期范围</p>
                        <div class="p-2 border border-gray-200 rounded-md bg-gray-50 text-sm">
                            X日 <span id="dayStartDisplay">00:00</span> 至 X+1日 <span id="dayEndDisplay">00:00</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-6 pb-4 border-b border-gray-100">
                <h4 class="font-medium mb-3">按周周期</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">周起始日</label>
                        <select id="weekStartDay" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="0">周日</option>
                            <option value="1" selected>周一</option>
                            <option value="2">周二</option>
                            <option value="3">周三</option>
                            <option value="4">周四</option>
                            <option value="5">周五</option>
                            <option value="6">周六</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">起始时间</label>
                        <input type="time" id="weekStartTime" class="w-full p-2 border border-gray-300 rounded-md" value="00:00">
                    </div>
                </div>
            </div>

            <div class="mb-6 pb-4 border-b border-gray-100">
                <h4 class="font-medium mb-3">按月周期</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">月起始日期</label>
                        <input type="number" id="monthStartDate" min="1" max="31" class="w-full p-2 border border-gray-300 rounded-md" value="1">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">起始时间</label>
                        <input type="time" id="monthStartTime" class="w-full p-2 border border-gray-300 rounded-md" value="00:00">
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h4 class="font-medium mb-3">按季度周期</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">季度起始月份</label>
                        <select id="quarterStartMonth" class="w-full p-2 border border-gray-300 rounded-md">
                            <option value="1">1月（Q1:1-3月）</option>
                            <option value="4">4月（Q2:4-6月）</option>
                            <option value="7">7月（Q3:7-9月）</option>
                            <option value="10">10月（Q4:10-12月）</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-600 mb-1">起始时间</label>
                        <input type="time" id="quarterStartTime" class="w-full p-2 border border-gray-300 rounded-md" value="00:00">
                    </div>
                </div>
            </div>

            <button id="saveGroupingConfig" class="w-full px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 transition-colors">
                保存配置
            </button>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../public/js/common/websocket-manager.js" defer></script>
    <script src="../public/js/common/multi-select-dropdown.js" defer></script>
    <script src="../public/js/pages/trend/trend-utils.js" defer></script>
    <script src="../public/js/common/theme-manager.js" defer></script>
    <script src="../public/js/pages/trend/trend-analysis-app.js" defer></script>
</body>
</html>
